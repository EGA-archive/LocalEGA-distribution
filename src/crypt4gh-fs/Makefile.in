
CC       = @CC@
CPPFLAGS = -I@srcdir@ -fPIC
CFLAGS   = @CFLAGS@ @CPPFLAGS@ @DEFS@ @DEBUG@
LIBS     = @LIBS@
LDFLAGS  = @LDFLAGS@

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir = @bindir@

OBJS = fs.o cache.o db.o pool.o readconf.o main.o

TARGET = crypt4gh-db.fs

.PHONY: crypt4gh-db.fs

all: $(TARGET)

$(bindir):
	mkdir -p $@

$(TARGET): $(OBJS)
	@$(CC) -o $@ $(OBJS) $(LDFLAGS) $(LIBS)

.c.o:
	@echo "Compiling $<"
	@$(CC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $<

install: $(TARGET) | $(bindir)
	@echo "Installing $< into $(bindir)"
	@install -m 755 $< $(bindir)

clean:
	-rm -f $(OBJS) $(TARGET)
	-@rm -f *~ 

distclean: clean
	-rm -f Makefile config.h* config.status configure config.log
	-rm -rf autom4te.cache .depend.old


###################################
## Dependencies
###################################
depend: depend-rebuild
	rm -f .depend.bak

depend-rebuild:
	mv .depend .depend.old
	rm -f config.h .depend
	touch config.h .depend
	makedepend -w1000 -I@srcdir@ @DEFS@ -f .depend *.c 2>/dev/null
	(echo '# Automatically generated by makedepend.'; \
	 echo '# Run "make depend" to rebuild.'; sort .depend ) > .depend.tmp
	mv .depend.tmp .depend
	rm -f .depend.bak
	mv .depend.old .depend.bak

depend-check: depend-rebuild
	cmp .depend .depend.bak || (echo .depend stale && exit 1)

# @DEPEND@
